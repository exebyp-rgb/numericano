---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ingredients from "../../data/data/ingredients.json";
import type { Ingredient } from "../../types";
import { buildTitle, buildDescription } from "../../lib/seo";
import { getDensityRangeGPerMl } from "../../lib/density";
import { formatNumber } from "../../lib/units";

export const prerender = true;

export function getStaticPaths() {
  const ING = ingredients as Ingredient[];
  return ING.map(i => ({ params: { slug: i.slug } }));
}

const ING = ingredients as Ingredient[];
const { slug } = Astro.params;
const ingredient = ING.find(i => i.slug === slug);
if (!ingredient) throw new Error("Ingredient not found");

const range = getDensityRangeGPerMl(ingredient);
const title = buildTitle([ingredient.name, "conversions"]);
const description = buildDescription(`Common conversions for ${ingredient.name}. Density varies by type and packing; see typical ranges and assumptions.`);
---
<BaseLayout title={title} description={description}>
  <h1 class="text-3xl font-semibold tracking-tight">{ingredient.name}</h1>
  <p class="mt-2 text-slate-700 max-w-2xl">{ingredient.notes}</p>

  <div class="mt-6 rounded-xl border p-5">
    <div class="text-sm text-slate-600">Density range (g/mL)</div>
    <div class="mt-1 text-2xl font-semibold">
      {formatNumber(range.min, 3)} – {formatNumber(range.max, 3)}
    </div>
    <div class="mt-3 text-sm text-slate-600">Variants</div>
    <ul class="mt-2 space-y-1 text-sm">
      {ingredient.variants.map(v => (
        <li><span class="font-medium">{v.label}:</span> {formatNumber(v.density_g_ml, 3)} g/mL</li>
      ))}
    </ul>
  </div>

  <div class="mt-6 text-sm">
    <a class="hover:underline" href="/cooking/">Go to Cooking hub</a>
    <span class="mx-2 text-slate-300">|</span>
    <a class="hover:underline" href="/volume-weight/">Go to Volume↔Weight hub</a>
  </div>
</BaseLayout>
