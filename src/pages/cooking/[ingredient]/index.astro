---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import ingredients from "../../../data/data/ingredients.json";
import cookingPairs from "../../../data/data/cookingPairs.json";
import type { Ingredient } from "../../../types";
import { buildTitle, buildDescription } from "../../../lib/seo";

type IngredientVariant = { name: string; density: number };
type Ing = {
  slug: string;
  name: string;
  notes?: string;
  variants: IngredientVariant[];
};

type Pair = {
  from: string;
  to: string;
};

export async function getStaticPaths() {
  const ING = ingredients as Ing[];
  return ING.map((ing) => ({
    params: { ingredient: ing.slug },
  }));
}

const ING = ingredients as Ing[];

const { ingredient } = Astro.params;
const ing = ING.find((i) => i.slug === ingredient) ?? ING[0];

if (!ing) {
  return Astro.redirect("/cooking");
}

// Only render conversion links for pairs that are actually generated
// Currently: first 10 pairs from cookingPairs.json
const ENABLED_PAIRS = (cookingPairs as Pair[]).slice(0, 10);

const conversions = ENABLED_PAIRS.map((pair) => ({
  from: pair.from,
  to: pair.to,
  url: `/cooking/${ing.slug}/${pair.from}-to-${pair.to}/`,
}));

const title = buildTitle([ing.name, "Cooking Conversions"]);
const description = buildDescription(`Convert ${ing.name} between different units: cups, tablespoons, teaspoons, grams and ounces using typical density values.`);
---

<BaseLayout title={title} description={description}>
  <h1>{ing.name} â€” Cooking</h1>
  <p>{ing.notes ?? ""}</p>
  
  <h2>Available Conversions</h2>
  <ul>
    {conversions.map((conv) => (
      <li><a href={conv.url}>{conv.from} to {conv.to}</a></li>
    ))}
  </ul>
</BaseLayout>
