---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import ingredients from "../../../data/data/ingredients.json";
import type { Ingredient } from "../../../types";
import { buildTitle, buildDescription } from "../../../lib/seo";

type IngredientVariant = { name: string; density: number };
type Ing = {
  slug: string;
  name: string;
  notes?: string;
  variants: IngredientVariant[];
};

const ING = ingredients as Ing[];

export async function getStaticPaths() {
  return ING.map((ing) => ({
    params: { ingredient: ing.slug },
  }));
}

const { ingredient } = Astro.params;
const ing = ING.find((i) => i.slug === ingredient) ?? ING[0];

if (!ing) {
  return Astro.redirect("/cooking");
}

const units = ["tsp", "tbsp", "cup", "g", "oz"];
const conversions = [];

for (let i = 0; i < units.length; i++) {
  for (let j = i + 1; j < units.length; j++) {
    conversions.push({
      from: units[i],
      to: units[j],
      url: `/cooking/${ing.slug}/${units[i]}-to-${units[j]}/`,
    });
    conversions.push({
      from: units[j],
      to: units[i],
      url: `/cooking/${ing.slug}/${units[j]}-to-${units[i]}/`,
    });
  }
}

const title = buildTitle(`${ing.name} conversions`);
const description = buildDescription(`Convert ${ing.name} between different units: cups, tablespoons, teaspoons, grams and ounces using typical density values.`);
---

<BaseLayout title={title} description={description}>
  <h1>{ing.name} â€” Cooking</h1>
  <p>{ing.notes ?? ""}</p>
  
  <h2>Available Conversions</h2>
  <ul>
    {conversions.map((conv) => (
      <li><a href={conv.url}>{conv.from} to {conv.to}</a></li>
    ))}
  </ul>
</BaseLayout>
